<template>
    <div style="position: relative; overflow:hidden" class="slds-card slds-grid">
        <div class="polygonClass">
        </div>
        <div class="borderClass">
        </div>
        <lightning-spinner lwc:if={mainLoading} size="medium"></lightning-spinner>
        <template lwc:else>
            <div class="div1Toggle">
                <lightning-icon icon-name='utility:chevronright' onclick={toggleDiv1} size="small">
                </lightning-icon>
            </div>
            <div class="div3Toggle">
                <lightning-icon icon-name='utility:chevronleft' onclick={toggleDiv3} size="small">
                </lightning-icon>
            </div>
            <!-- DIV 1 -->
            <div class="div1">
                <div class="slds-grid slds-p-around--medium">
                    <div>
                        <div class="slds-align_absolute-center p1">
                            <div style={p1Style}> </div>
                        </div>
                        <div class="slds-align_absolute-center slds-m-top--large">
                            <div style={p2Style}> </div>
                        </div>
                    </div>
                    <div class="caseInfoDiv clickableDiv slds-p-top--large slds-m-left--large" style="width: 80%;"
                        data-name="store_case" onclick={handleRecordCall}>
                        <p data-name="store_case" class="titleClass fontSize1">{storeCase.Name}</p>
                        <p data-name="store_case" class="bold2 fontSize1">{storeCase.RecordType.Name}</p>
                        <template lwc:if={storeCase.Business_Process__r}>
                            <p data-name="store_case" class="titleClass fontSize1">{storeCase.Business_Process__r.Name}
                            </p>
                        </template>
                        <template lwc:if={storeCase.Sub_Epic__r}>
                            <p data-name="store_case" class="titleClass fontSize3" style="font-style: italic;">
                                {storeCase.Sub_Epic__r.Name}</p>
                        </template>
                    </div>
                </div>
                <div class="blueDiv slds-p-right--large" style="height:100%">
                    <div class="clickableDiv slds-grid slds-p-top--large" data-name="contact"
                        onclick={handleRecordCall}>
                        <div data-name="contact" class="slds-align_absolute-center" style="width: 20%; height: 100%;">
                            <div style={Contact_Logo_Blue_Icon}>
                            </div>
                        </div>
                        <div style="width: 80%;">
                            <p data-name="contact" class="bold2 fontSize3">{fieldLabelsMap.Contact_Name} :
                                {storeCase.Contact_First_Name__c}
                            </p>
                            <p data-name="contact" class="titleClass fontSize3">{fieldLabelsMap.Contact_Email} :
                                {storeCase.Contact_Email__c}
                            </p>
                        </div>

                    </div>
                    <div>
                        <hr class="solid slds-m-around--large">
                    </div>
                    <div class="clickableDiv slds-grid slds-p-bottom--large" data-name="related_cases"
                        onclick={handleRecordCall}>
                        <div data-name="related_cases" class="slds-align_absolute-center"
                            style="width: 20%; height: 100%;">
                            <div style={Question_Logo_Blue_Icon}></div>
                        </div>
                        <div style="width: 80%;">
                            <p data-name="related_cases" class="bold2 fontSize3">{labels.LBL_Related_Tickets}</p>
                            <p data-name="related_cases" class="titleClass fontSize3">{labels.LBL_Current_Cases}
                                {currentCasesCount}</p>
                            <p data-name="related_cases" class="titleClass fontSize3">{labels.LBL_Missed_Deadline}
                                {missedDeadlineCasesCount}</p>
                            <div data-name="related_cases" lwc:if={storeCase.Client_Contact__r} class="slds-grid">
                                <p data-name="related_cases" class="titleClass fontSize3 slds-p-top--x-small">Niveau
                                    Satisfaction:</p>
                                <lightning-formatted-rich-text data-name="related_cases"
                                    value={storeCase.Client_Contact__r.Satisfaction_Logo_URL__c}>
                                </lightning-formatted-rich-text>
                            </div>
                            <p data-name="related_cases" class="titleClass fontSize3">{labels.LBL_All_Cases}
                                {allCasesCount}</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- DIV 2 -->
            <div class="div2 slds-m-around--small">
                <!-- BUTTON LIST -->
                <div class="buttonGroupContainer">
                    <div class="buttonContainer">
                        <div class="actionButton callButton" aria-haspopup="true" onclick={handleRecordCall}
                            data-name={Work_Ticket_Qualification_Process_flowApiName}>
                            {labels.LBL_Qualify_Ticket}
                        </div>
                    </div>
                    <div class="buttonContainer">
                        <div class="actionButton emailButton" aria-haspopup="true" onclick={handleRecordCall}
                            data-name={Work_Email_Notification_Activation_flowApiName}>
                            {labels.LBL_Set_Email_Notifications}
                        </div>
                    </div>
                    <div class="buttonContainer">
                        <div class="actionButton relaunchButton" aria-haspopup="true" onclick={handleRecordCall}
                            data-name={Work_Register_Communication_Process_flowApiName}>
                            {labels.LBL_Register_Communication}
                        </div>
                    </div>
                    <div class="buttonContainer">
                        <div class="actionButton statusButton" aria-haspopup="true" onclick={handleRecordCall}
                            data-name={Work_Status_Change_Process_flowApiName}>
                            {labels.LBL_Changer_Le_Status}
                        </div>
                    </div>
                </div>
                <!-- Work TAB -->
                <lightning-record-edit-form record-id={storeCase.Id} object-api-name="agf__ADM_Work__c">
                    <div class="sectionTitle slds-m-horizontal--x-small">
                        <div>
                            <div class="slds-truncate slds-p-horizontal_small titleClass">
                                <lightning-input-field value={storeCase.Name} field-name="Name"
                                    data-object="agf__ADM_Work__c" data-field="Name" onchange={handleFieldEdits}>
                                </lightning-input-field>
                            </div>
                        </div>
                        <div class="slds-truncate slds-p-horizontal_small subTitleClass">
                            <lightning-input-field value={storeCase.agf__Subject__c} field-name="agf__Subject__c"
                                data-object="agf__ADM_Work__c" data-field="agf__Subject__c" onchange={handleFieldEdits}>
                            </lightning-input-field>
                        </div>
                        <!--<div class="editButton" data-name="store_case_full" onclick={handleRecordCall}>
                        <lightning-button-icon variant="bare" size="medium" icon-name="utility:edit"
                            data-name="store_case_full" onclick={handleRecordCall}></lightning-button-icon>
                    </div>-->
                    </div>
                </lightning-record-edit-form>
                <div style="position: relative" class="productTabClass slds-m-top--small">
                    <!--section for selected fields in Field configuration-->
                    <div class="slds-form__row">
                        <div class="slds-form__item" role="listitem">
                            <lightning-combobox name="FieldConfigOptions" label="Select Fields Template"
                                value={selectedFieldConfig} placeholder="Select Fields Template"
                                options={fieldConfigOptions} data-name="store_case_full"
                                onchange={handleChangeFieldConfig}>
                            </lightning-combobox>
                        </div>
                        
                        
                    </div>
                        <lightning-record-edit-form record-id={storeCase.Id} object-api-name="agf__ADM_Work__c">
                            <template for:each={fieldconfigResult} for:item="fieldconfig" for:index="index">
                                <div class="slds-form__row" key={fieldconfig.id}>
                                    <template for:each={fieldconfig.fields} for:item="field" for:index="index1">
                                        <div class="slds-form__item" role="listitem" key={field.id}>
                                            <div
                                                class="slds-form-element slds-form-element_edit slds-form-element_stacked slds-hint-parent">
                                                <div class="slds-form-element__control">
                                                    <div class="slds-form-element__static">
                                                        <lightning-input-field value={field.value}
                                                            field-name={field.apiName} data-object="agf__ADM_Work__c"
                                                            data-field={field.apiName} onchange={handleFieldEdits} required={field.isMandatory} readonly={field.isReadOnly}>
                                                        </lightning-input-field>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </template>
                        </lightning-record-edit-form>
                </div>
                <template lwc:if={showEditStoreCaseGrid}>
                    <div class="slds-align--absolute-center slds-modal__footer">
                        <button class="slds-button slds-button_neutral" aria-label={labels.LBL_Cancel}
                            onclick={cancelDescentProduct}>{labels.LBL_Cancel}</button>
                        <button class="slds-button slds-button_brand" data-object="agf__ADM_Work__c"
                            onclick={saveHandler}>{labels.LBL_Save}</button>
                    </div>
                </template>
                <!-- TAB SET -->
                <div class="slds-p-top--medium tabSetClass">
                    <lightning-tabset variant="scoped" active-tab-value="1" style="width: 100%;">
                        <!-- Dev Requests -->
                        <lightning-tab style="padding: 0;" label={labels.LBL_Dev_Requests} value="1"
                            onactive={handleFirstTab}>
                            <div class="slds-p-around--medium slds-scrollable tabClass" style="position: relative;">
                                <div class="buttonContainer">
                                    <div class="actionButton callButton" aria-haspopup="true" onclick={handleRecordCall}
                                        data-name={Work_Create_Dev_Request_From_Bug_Or_User_Story_flowApiName}>
                                        {labels.agf__ADM_Work_Create}
                                    </div>
                                </div>
                                <template for:each={devrequestsWork} for:item="devrequest" for:index="index">
                                    <div class="slds-grid" key={devrequest.Id}>
                                        <lightning-record-edit-form record-id={devrequest.Id}
                                            object-api-name="agf__ADM_Work__c">
                                            <lightning-input-field value={devrequest.Name} field-name="Name"
                                                data-object="agf__ADM_Work__c" data-field="Name"
                                                onchange={handleFieldEdits}>
                                            </lightning-input-field>
                                            <lightning-input-field value={devrequest.Subject}
                                                field-name="agf__Subject__c" data-object="agf__ADM_Work__c"
                                                data-field="agf__Subject__c" onchange={handleFieldEdits}>
                                            </lightning-input-field>
                                            <lightning-input-field value={devrequest.DevStatus}
                                                field-name="Dev_Status__c" data-object="agf__ADM_Work__c"
                                                data-field="Dev_Status__c" onchange={handleFieldEdits}>
                                            </lightning-input-field>
                                            <lightning-input-field value={devrequest.manager}
                                                field-name="agf__Senior_Management_POC__c"
                                                data-object="agf__ADM_Work__c"
                                                data-field="agf__Senior_Management_POC__c" onchange={handleFieldEdits}>
                                            </lightning-input-field>
                                            <lightning-input-field value={devrequest.Developer}
                                                field-name="Developpeur__c" data-object="agf__ADM_Work__c"
                                                data-field="Developpeur__c" onchange={handleFieldEdits}>
                                            </lightning-input-field>
                                        </lightning-record-edit-form>
                                    </div>
                                </template>
                            </div>
                        </lightning-tab>
                        <!-- EXTERNAL Q&A -->
                        <lightning-tab style="padding: 0;" label={labels.LBL_QA} value="2" onactive={handleSecondTab}>
                            <div class="tabClass slds-scrollable">
                                <div style="position:relative;background: #F3F3F3;min-height: 30px;">
                                    <!--  <div lwc:if={externalEditMode}
                                        style="width: 288px; padding-left: 15px;padding-bottom: 10px;"
                                        class="slds-p-vertical--xx-small">
                                        <lightning-combobox name='quesTemplateCombobox'
                                            label={fieldLabelsMap.agf__ADM_Work__c_Questionnaire_Template__c}
                                            value={storeCase.Questionnaire_Template__c}
                                            placeholder={fieldLabelsMap.agf__ADM_Work__c_Questionnaire_Template__c}
                                            options={questionnaireTemplateOptions}
                                            data-field="Questionnaire_Template__c"
                                            onchange={handleFieldEdits}></lightning-combobox>
                                    </div>
                                    <div lwc:elseif={storeCase.Questionnaire_Template__r}
                                        style="font-size: 15px; font-weight: 700; padding-left: 15px;"
                                        class="slds-p-around--medium">
                                        {storeCase.Questionnaire_Template__r.Name}
                                    </div> -->
                                    <div class="questionEditButton">
                                        <template lwc:if={externalEditMode}>
                                            <lightning-button-icon icon-name="utility:add"
                                                class="slds-p-right--x-small slds-modal__footer_directional"
                                                variant="border-filled" title={labels.LBL_Add} label={labels.LBL_Add}
                                                onclick={handleNewExternalQA}></lightning-button-icon>
                                            <lightning-button class="slds-p-right--x-small" variant="brand"
                                                title={labels.LBL_Save} label={labels.LBL_Save} onclick={handleSaveList}
                                                data-list="QandA"></lightning-button>
                                            <lightning-button class="slds-p-right--x-small" variant="bare"
                                                title={labels.LBL_Cancel} label={labels.LBL_Cancel}
                                                onclick={handleCancelExternal}></lightning-button>
                                        </template>
                                        <template lwc:else>
                                            <lightning-button-icon class="slds-m-left--x-small" variant="bare"
                                                icon-name="utility:edit"
                                                onclick={toggleExternalQuestionEditMode}></lightning-button-icon>
                                        </template>
                                    </div>
                                </div>
                                <div class="slds-p-around--medium slds-scrollable"
                                    style="position:relative; min-height:300px">
                                    <lightning-spinner lwc:if={tabSetLoading} size="medium"></lightning-spinner>
                                    <template lwc:else for:each={externalQuestionList} for:item="question"
                                        for:index="index">
                                        <div if:false={question.isDeleted} key={question.Id}
                                            class="slds-m-bottom--medium slds-grid">
                                            <template lwc:if={externalEditMode}>
                                                <div class="slds-p-right--medium" style="margin-top: 51px;">
                                                    <lightning-button-icon icon-name="utility:copy"
                                                        data-id={question.Id} size="large"
                                                        onclick={toggleEditProductMode}></lightning-button-icon>
                                                    <lightning-button-icon class="slds-m-left--x-small" size="large"
                                                        icon-name="utility:close" data-index={index} data-list="QandA"
                                                        onclick={handleDeleteList}></lightning-button-icon>
                                                </div>
                                                <div class="slds-col slds-p-left--medium slds-border--left">
                                                    <div>
                                                        <lightning-input
                                                            label={fieldLabelsMap.Questionnaire_Details__c_Question_Title__c}
                                                            onchange={handleListFieldEdit} data-list="QandA"
                                                            data-field="Question_Title__c" data-index={index}
                                                            value={question.Question_Title__c}>
                                                        </lightning-input>
                                                    </div>
                                                    <div>
                                                        <lightning-input
                                                            label={fieldLabelsMap.Questionnaire_Details__c_Short_Answer__c}
                                                            onchange={handleListFieldEdit} data-list="QandA"
                                                            data-field="Short_Answer__c" data-index={index}
                                                            value={question.Short_Answer__c}>
                                                        </lightning-input>
                                                    </div>
                                                </div>
                                            </template>
                                            <template lwc:else>
                                                <div class="slds-col">
                                                    <div class="question">
                                                        Q: {question.Question_Title__c}
                                                    </div>
                                                    <div class="answer">
                                                        {question.Short_Answer__c}
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </lightning-tab>
                        <!-- ACTIVITY SUMMARY -->
                        <lightning-tab style="padding: 0;" label={labels.LBL_Activity_Summary} value="3"
                            onactive={handleThirdTab}>
                            <div class="slds-p-around--medium slds-scrollable tabClass" style="position: relative;">
                                <template iterator:activity={activityList}>
                                    <div key={activity.value.Id} style="position:relative">
                                        <div class="acitivityIcon" style="position: absolute;">
                                            <div style={activity.value.Activity_Type_Logo}></div>
                                        </div>
                                        <div lwc:if={activity.last}
                                            class="slds-col slds-p-left--x-large slds-m-left--large">
                                            <div class="titleClass slds-m-bottom--small">
                                                {activity.value.Activity_Type__c}</div>
                                            <div>{labels.LBL_Created_Date}: <lightning-formatted-date-time
                                                    value={activity.value.CreatedDate} year="numeric" month="numeric"
                                                    day="numeric" hour="2-digit" minute="2-digit" hour12="false">
                                                </lightning-formatted-date-time>
                                            </div>
                                            <div lwc:if={activity.value.Contact__r}>{labels.LBL_Contact}:
                                                {activity.value.Contact__r.Name}</div>
                                            <div>{labels.LBL_Subject}: <lightning-formatted-rich-text
                                                    value={activity.value.Subject_URL__c}>
                                                </lightning-formatted-rich-text></div>
                                        </div>
                                        <div lwc:else
                                            class="slds-col slds-p-left--x-large slds-m-left--large slds-p-bottom--large"
                                            style="border-left: 1px dashed">
                                            <div class="titleClass slds-m-bottom--small">
                                                {activity.value.Activity_Type__c}</div>
                                            <div>{labels.LBL_Created_Date}: <lightning-formatted-date-time
                                                    value={activity.value.CreatedDate} year="numeric" month="numeric"
                                                    day="numeric" hour="2-digit" minute="2-digit" hour12="false">
                                                </lightning-formatted-date-time>
                                            </div>
                                            <div lwc:if={activity.value.Contact__r}>{labels.LBL_Contact}:
                                                {activity.value.Contact__r.Name}</div>
                                            <div>{labels.LBL_Subject}: <lightning-formatted-rich-text
                                                    value={activity.value.Subject_URL__c}>
                                                </lightning-formatted-rich-text></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.LBL_Spec_Library} value="4"
                            onactive={handleThirdTab}>
                            <template for:each={specLibraries} for:item="specLibrary" for:index="index">
                                <div class="slds-grid" key={specLibrary.Id}>
                                    <lightning-record-edit-form record-id={specLibrary.Id}
                                        object-api-name="Spec_Library_Assignment__c">
                                    <div class="slds-grid slds-wrap">
                                        <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.Name} field-name="Name"
                                            data-object="Spec_Library_Assignment__c" data-field="Name"
                                            onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.documentName}
                                            field-name="Document_Name__c" data-object="Spec_Library_Assignment__c"
                                            data-field="Document_Name__c" onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                      </div>
                                      <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.latestVersion}
                                            field-name="Latest_Version__c" data-object="Spec_Library_Assignment__c"
                                            data-field="Latest_Version__c" onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.viewAllversions}
                                            field-name="View_All_Versions__c" data-object="Spec_Library_Assignment__c"
                                            data-field="View_All_Versions__c" onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.viewFile} field-name="View_File__c"
                                            data-object="Spec_Library_Assignment__c" data-field="View_File__c"
                                            onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input-field value={specLibrary.SpecCreatedDate}
                                            field-name="Spec_Library__c" data-object="Spec_Library_Assignment__c"
                                            data-field="Spec_Library__c" onchange={handleFieldEdits}>
                                        </lightning-input-field>
                                    </div>
                                    </div>
                                    </lightning-record-edit-form>
                                </div>
                            </template>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.Attachments} value="5"
                            onactive={handleThirdTab}>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.agf__ADM_Chatter} value="6"
                            onactive={handleThirdTab}>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.LBL_Labels} value="7"
                            onactive={handleThirdTab}>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.LBL_Deliveries} value="8"
                            onactive={handleThirdTab}>
                        </lightning-tab>
                        <lightning-tab style="padding: 0;" label={labels.LBL_History} value="9"
                            onactive={handleThirdTab}>
                        </lightning-tab>
                    </lightning-tabset>
                </div>
            </div>
            <!-- DIV 3 -->
            <div lwc:if={currentStatus} class="div3">
                <!-- STATUS TITLE -->
                <div class="statusTitle slds-m-around--small" style="overflow:hidden">
                    <div class="slds-grid statusIcon">
                        <div style={p3Style}>
                        </div>
                        <div class="titleClass slds-m-left--medium titleClass fontSize1" style="margin-top: 6px;">
                            {fieldLabelsMap.Work_Activity__c_Status__c}: {storeCase.agf__Status__c}</div>
                    </div>
                    <div class="titleClass" style="font-style:italic;">
                        {fieldLabelsMap.agf__ADM_Work__c_CreatedDate}: &nbsp;
                        <lightning-formatted-date-time value={storeCase.CreatedDate} year="numeric" month="numeric"
                            day="numeric" hour="2-digit" minute="2-digit"
                            hour12="false"></lightning-formatted-date-time>
                    </div>
                    <div class="titleClass" style="font-style:italic;">
                        {fieldLabelsMap.agf__ADM_Work__c_agf__Created_On_import__c} &nbsp;
                        <lightning-formatted-date-time year="numeric" month="numeric" day="numeric" hour="2-digit"
                            minute="2-digit" hour12="false"
                            value={storeCase.agf__Created_On_import__c}></lightning-formatted-date-time>
                    </div>
                    <div class="titleClass" style="font-style:italic;">
                        {fieldLabelsMap.agf__ADM_Work__c_Date_Delivered__c} &nbsp;
                        <lightning-formatted-date-time year="numeric" month="numeric" day="numeric" hour="2-digit"
                            minute="2-digit" hour12="false"
                            value={storeCase.Date_Delivered__c}></lightning-formatted-date-time>
                    </div>
                </div>
                <!-- STATUS CHANGE LIST -->
                <div
                    class="slds-box slds-m-around--small slds-p-around--small statusList slds-m-left--medium slds-scrollable">
                    <template iterator:activity={statusHistoryList}>
                        <div key={activity.value.Id} class="slds-grid" style="position:relative">
                            <div class="acitivityIcon" style="position: absolute;">
                                <div style={activity.value.Status_Logo}></div>
                            </div>
                            <div lwc:if={activity.last} class="slds-col slds-p-left--x-large slds-m-left--large">
                                <div class="titleClass">{fieldLabelsMap.Work_Activity__c_Status__c}:
                                    {activity.value.Status__c}
                                </div>
                                <template lwc:if={activity.value.isOpen}>
                                    <div lwc:if={storeCase.CreatedBy}>{labels.LBL_Created_By}
                                        {storeCase.CreatedBy.Name}
                                    </div>
                                    <div>{fieldLabelsMap.agf__ADM_Work__c_CreatedDate}: &nbsp;
                                        <lightning-formatted-date-time value={storeCase.CreatedDate} year="numeric"
                                            month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false">
                                        </lightning-formatted-date-time>
                                    </div>
                                </template>
                                <template lwc:if={activity.value.isAssigned}>
                                    <div lwc:if={storeCase.agf__Assignee__r}>
                                        {fieldLabelsMap.agf__ADM_Work__c_agf__Assignee__c}: &nbsp;
                                        <a href={storeCase.assignedToLink} target="_blank">
                                            {storeCase.agf__Assignee__r.Name}
                                        </a>
                                    </div>

                                </template>
                                <template lwc:if={activity.value.isClosed}>
                                    <div>{fieldLabelsMap.Work_Activity__c_Update_Date__c}: &nbsp;
                                        <lightning-formatted-date-time value={activity.value.Update_Date__c}
                                            year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false">
                                        </lightning-formatted-date-time>
                                    </div>
                                </template>
                                <template lwc:if={activity.value.isPending}>
                                    <div>{fieldLabelsMap.Work_Activity__c_Transferred_To__c}:
                                        {activity.value.Transferred_To__c}</div>
                                    <div>{fieldLabelsMap.Work_Activity__c_Update_Date__c}: &nbsp;
                                        <lightning-formatted-date-time value={activity.value.Update_Date__c}
                                            year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false"></lightning-formatted-date-time>
                                    </div>
                                </template>
                            </div>
                            <div lwc:else class="slds-col slds-p-left--x-large slds-m-left--large slds-p-bottom_x-large"
                                style="border-left: 1px dashed black; ">
                                <div class="titleClass">{fieldLabelsMap.Work_Activity__c_Status__c}:
                                    {activity.value.Status__c}</div>
                                <template lwc:if={activity.value.isOpen}>
                                    <div lwc:if={storeCase.CreatedBy}>{labels.LBL_Created_By}: &nbsp;
                                        <a href={storeCase.createdByLink} target="_blank">
                                            {storeCase.CreatedBy.Name}
                                        </a>
                                    </div>
                                    <div>{fieldLabelsMap.agf__ADM_Work__c_CreatedDate}: &nbsp;
                                        <lightning-formatted-date-time value={storeCase.CreatedDate} year="numeric"
                                            month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false">
                                        </lightning-formatted-date-time>
                                    </div>
                                </template>
                                <template lwc:if={activity.value.isAssigned}>
                                    <div>{fieldLabelsMap.agf__ADM_Work__c_agf__Assignee__c}: &nbsp;
                                        <a href={storeCase.assignedToLink} target="_blank">
                                            {storeCase.agf__Assignee__r.Name}
                                        </a>
                                    </div>

                                </template>
                                <template lwc:if={activity.value.isClosed}>
                                    <div>{fieldLabelsMap.Work_Activity__c_Update_Date__c}: &nbsp;
                                        <lightning-formatted-date-time value={activity.value.Update_Date__c}
                                            year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false"></lightning-formatted-date-time>
                                    </div>
                                </template>
                                <template lwc:if={activity.value.isPending}>
                                    <div>{fieldLabelsMap.Work_Activity__c_Transferred_To__c}:
                                        {activity.value.Transferred_To__c}</div>
                                    <div>{fieldLabelsMap.Work_Activity__c_Update_Date__c}: &nbsp;
                                        <lightning-formatted-date-time value={activity.value.Update_Date__c}
                                            year="numeric" month="numeric" day="numeric" hour="2-digit" minute="2-digit"
                                            hour12="false"></lightning-formatted-date-time>
                                    </div>
                                </template>
                            </div>
                            <div lwc:if={activity.value.displayPic} class="profileIcon">
                                <template lwc:if={activity.value.isOpen}>
                                    <div style={activity.value.CreatedBy}></div>
                                </template>
                                <template lwc:elseif={activity.value.isAssigned}>
                                    <div style={activity.value.Assigned_To}></div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>
                <!-- NEXT STEPS -->
                <lightning-spinner lwc:if={newSectionLoading} size="medium"></lightning-spinner>
                <template lwc:else>
                    <div class="slds-m-around--small nextSteps1">
                        <div class="nextStepTitle">
                            <div class="addButton"
                                style="height:10%; position: absolute; left:7px; top:6px; color:white"
                                data-name="SCREEN_Work_Create_New_Bug_Task" onclick={handleRecordCall}>
                                <lightning-icon class="addButton slds-current-color" variant="bare" size="x-small"
                                    icon-name="utility:add" data-name="SCREEN_Work_Create_New_Bug_Task"
                                    onclick={handleRecordCall}></lightning-icon>
                            </div>
                            <div style="padding-top: 7px;">
                                {labels.LBL_Next_Steps}
                            </div>
                        </div>
                        <div class="slds-grid slds-border_left slds-border_right slds-border_bottom"
                            style="min-height:200px;height:90%;position:relative;">
                            <lightning-spinner lwc:if={newSectionLoading} size="medium"></lightning-spinner>
                            <table class="slds-table nextstepTable">
                                <thead>
                                    <tr>
                                        <th style=" border-color: #A8A8A8 !important;" class="slds-text-align_center">
                                        </th>
                                        <th style=" border-color: #A8A8A8 !important;" class="slds-text-align_center">
                                            Tache
                                        </th>
                                        <!-- <th style=" border-color: #A8A8A8 !important;" class="slds-text-align_center">{fieldLabelsMap.agf__ADM_Task__c_Name}</th> -->
                                        <th style=" border-color: #A8A8A8 !important;" class="slds-text-align_center">
                                            {fieldLabelsMap.agf__ADM_Task__c_Status_Logo__c}</th>
                                        <th style=" border-color: #A8A8A8 !important;" class="slds-text-align_center">
                                            {fieldLabelsMap.agf__ADM_Task__c_agf__Assigned_To__c}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={promoTaskList} for:item="task" for:index="index">
                                        <tr key={task}>
                                            <td data-index={index} onclick={toggleEditPopover}
                                                class="slds-text-align_center">
                                                <div class="nextStepRow">
                                                    <lightning-button-icon variant="bare" size="small" data-id={task.Id}
                                                        data-name="cloneTask" data-task={task.agf__Subject__c}
                                                        icon-name="utility:copy"
                                                        onclick={handleCloneDeleteTask}></lightning-button-icon>
                                                    <lightning-button-icon variant="bare" size="small"
                                                        icon-name="utility:edit" data-id={task.Id}
                                                        data-task={task.agf__Subject__c}
                                                        data-name="SCREEN_Task_Update_Task" onclick={handleRecordCall}>
                                                    </lightning-button-icon>
                                                    <lightning-button-icon variant="bare" size="small" data-id={task.Id}
                                                        data-name="deleteTask" icon-name="utility:close"
                                                        data-list="SCREEN_Task_Update_Task"
                                                        onclick={handleCloneDeleteTask}></lightning-button-icon>
                                                </div>
                                                <template lwc:if={task.isEditPopoverOpen}>
                                                    <div class="slds-popover slds-popover_panel slds-nubbin_right-bottom popover1"
                                                        data-cp-name='Record'>
                                                        <div class="slds-popover__header">
                                                            <header class="slds-media slds-media_center">
                                                                <div class="slds-media__body">
                                                                    <h2 class="slds-text-heading_medium slds-hyphenate">
                                                                        {task.agf__Subject__c}
                                                                    </h2>
                                                                </div>
                                                            </header>
                                                        </div>
                                                        <div
                                                            class="slds-popover__body slds-text-align_left slds-p-around_small popoverBody1">
                                                            <lightning-record-form object-api-name="agf__ADM_Task__c"
                                                                record-id={task.Id} fields={taskFields} columns="2"
                                                                mode="edit" onsubmit={loadData}
                                                                oncancel={closeEditPopovers}>>
                                                            </lightning-record-form>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template lwc:elseif={task.isPopoverOpen}>
                                                    <div class="slds-popover slds-popover_panel slds-nubbin_right-bottom popover2"
                                                        data-cp-name='Record'>
                                                        <div class="slds-popover__header">
                                                            <header class="slds-media slds-media_center">
                                                                <div class="slds-media__body">
                                                                    <h2 class="slds-text-heading_medium slds-hyphenate">
                                                                        {task.agf__Subject__c}
                                                                    </h2>
                                                                </div>
                                                            </header>
                                                        </div>
                                                        <div
                                                            class="slds-popover__body slds-text-align_left slds-m-around_x-small popoverBody2">
                                                            <lightning-record-form object-api-name="agf__ADM_Task__c"
                                                                record-id={task.Id} fields={taskFields} columns="2"
                                                                data-index={index} mode="readonly" onsubmit={loadData}>
                                                            </lightning-record-form>
                                                        </div>
                                                    </div>
                                                </template>
                                            </td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index}
                                                lwc:if={task.agf__Subject__c} class="slds-text-align_left"
                                                style="white-space: break-spaces;">
                                                {task.agf__Subject__c}</td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index} lwc:else></td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index}
                                                lwc:if={task.Status_Logo__c} class="slds-text-align_center">
                                                <div style="padding-top:10px">
                                                    <lightning-formatted-rich-text value={task.Status_Logo__c}>
                                                    </lightning-formatted-rich-text>
                                                </div>
                                            </td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index} lwc:else
                                                class="slds-text-align_center"></td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index}
                                                lwc:if={task.agf__Assigned_To__c} class="slds-text-align_center">
                                                <a href={task.contactLink}
                                                    target="_blank">{task.agf__Assigned_To__r.Name}</a>
                                            </td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index} lwc:else></td>
                                        </tr>
                                    </template>
                                    <template if:false={promoTaskList.length}>
                                        <tr>
                                            <td colspan="5">
                                                <div class="slds-text-align_center">
                                                    <p>{labels.LBL_No_Item_To_Display}</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="slds-m-around--small nextSteps2">
                        <div class="nextStepTitle">
                            <div class="addButton"
                                style="height:10%; position: absolute; left:7px; top:6px; color:white"
                                data-name="SCREEN_Work_Create_New_Bug_Task" onclick={handleRecordCall}>
                                <lightning-icon class="addButton slds-current-color" variant="bare" size="x-small"
                                    icon-name="utility:add" data-name="SCREEN_Work_Create_New_Bug_Task"
                                    onclick={handleRecordCall}></lightning-icon>
                            </div>
                            <div style="position: absolute;top: 6px;left: 38%;">
                                {labels.LBL_Next_Steps}
                            </div>
                        </div>
                        <div class="slds-border_left slds-border_right slds-border_bottom">
                            <table class="slds-table nextstepVerticalTable slds-table--bordered">
                                <tbody>
                                    <template for:each={promoTaskList} for:item="task" for:index="index">
                                        <tr key={task}>
                                            <td class="nextStepHeader">
                                                <div class="padding">
                                                    {fieldLabelsMap.agf__ADM_Task__c_agf__Subject__c}
                                                </div>
                                            </td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index}
                                                class="slds-text-align_center">
                                                <div class="padding" data-index={index}>
                                                    {task.agf__Subject__c}
                                                </div>
                                            </td>
                                        </tr>
                                        <tr key={task}>
                                            <td class="nextStepHeader">
                                                <div class="padding">
                                                    {fieldLabelsMap.agf__ADM_Task__c_Status_Logo__c}
                                                </div>
                                                <template lwc:if={task.isEditPopoverOpen}>
                                                    <div class="slds-popover slds-popover_panel slds-nubbin_right-bottom popover1Vertical"
                                                        data-cp-name='Record'>
                                                        <div class="slds-popover__header">
                                                            <header class="slds-media slds-media_center">
                                                                <div class="slds-media__body">
                                                                    <h2 class="slds-text-heading_medium slds-hyphenate">
                                                                        {task.agf__Subject__c}
                                                                    </h2>
                                                                </div>
                                                            </header>
                                                        </div>
                                                        <div class="slds-popover__body slds-text-align_left slds-p-around_small popoverBody1"
                                                            style="position: relative;">
                                                            <lightning-spinner lwc:if={newSectionLoading}
                                                                size="medium"></lightning-spinner>
                                                            <lightning-record-form object-api-name="agf__ADM_Task__c"
                                                                record-id={task.Id} fields={taskFields} columns="2"
                                                                mode="edit" onsubmit={loadData}
                                                                oncancel={closeEditPopovers}>>
                                                            </lightning-record-form>
                                                        </div>
                                                    </div>
                                                </template>
                                                <template lwc:elseif={task.isPopoverOpen}>
                                                    <div class="slds-popover slds-popover_panel slds-nubbin_right-bottom popover2Vertical"
                                                        data-cp-name='Record'>
                                                        <div class="slds-popover__header">
                                                            <header class="slds-media slds-media_center">
                                                                <div class="slds-media__body">
                                                                    <h2 class="slds-text-heading_medium slds-hyphenate">
                                                                        {task.agf__Subject__c}
                                                                    </h2>
                                                                </div>
                                                            </header>
                                                        </div>
                                                        <div class="slds-popover__body slds-text-align_left slds-m-around_x-small popoverBody2"
                                                            style="position: relative;">
                                                            <lightning-record-form class="slds-m-vertical--small"
                                                                object-api-name="agf__ADM_Task__c" record-id={task.Id}
                                                                fields={taskFields} columns="2" data-index={index}
                                                                mode="readonly" onsubmit={loadData}>
                                                            </lightning-record-form>
                                                        </div>
                                                    </div>
                                                </template>
                                            </td>
                                            <td data-index={index} onclick={toggleEditPopover}
                                                onmouseenter={openPopover} onmouseleave={closePopover}
                                                class="slds-text-align_center">
                                                <div style="padding-top:10px" data-index={index}>
                                                    <lightning-formatted-rich-text value={task.Status_Logo__c}>
                                                    </lightning-formatted-rich-text>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr key={task}>
                                            <td class="nextStepHeader">
                                                <div class="padding">
                                                    {fieldLabelsMap.agf__ADM_Task__c_agf__Assigned_To__c}
                                                </div>
                                            </td>
                                            <td onclick={toggleEditPopover} onmouseenter={openPopover}
                                                onmouseleave={closePopover} data-index={index}
                                                class="slds-text-align_center">
                                                <div class="padding" data-index={index}
                                                    lwc:if={task.agf__Assigned_To__c}>
                                                    <a href={task.contactLink}
                                                        target="_blank">{task.agf__Assigned_To__r.Name}</a>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr key={task}>
                                            <td class="nextStepHeader borderBottom">
                                                <div class="padding">
                                                    LBL_Actions
                                                </div>
                                            </td>
                                            <td class="borderBottom">
                                                <div class="padding" style="text-align: center;">
                                                    <lightning-button-icon size="small" data-id={task.Id}
                                                        data-name="cloneTask" data-task={task.agf__Subject__c}
                                                        icon-name="utility:copy"
                                                        onclick={handleCloneDeleteTask}></lightning-button-icon>
                                                    <lightning-button-icon style="margin-left: 8px;" size="small"
                                                        data-id={task.Id} data-name="deleteTask"
                                                        icon-name="utility:close" data-list="SCREEN_Task_Update_Task"
                                                        onclick={handleCloneDeleteTask}></lightning-button-icon>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    <template if:false={promoTaskList.length}>
                                        <tr>
                                            <td colspan="5">
                                                <div class="slds-text-align_center">
                                                    <p>{labels.LBL_No_Item_To_Display}</p>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </template>
            </div>
        </template>
    </div>
    <template if:true={popupFlow}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container" style="min-width: 75% !important">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                    onclick={cancelDescentProduct}>
                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close">
                        </use>
                    </svg>
                    <span class="slds-assistive-text">{labels.LBL_Cancel}</span>
                </button>
                <header class="slds-modal__header">
                    <div lwc:if={popupFlow1}>{labels.LBL_Qualify_Ticket}</div>
                    <div lwc:if={popupFlow2}>{labels.LBL_Set_Email_Notifications}</div>
                    <div lwc:if={popupFlow3}>{labels.LBL_Register_Communication}</div>
                    <div lwc:if={popupFlow4}>{labels.LBL_Changer_Le_Status}</div>
                    <div lwc:if={popupFlow5}>{labels.LBL_Change_RecordType}</div>
                    <div lwc:if={popupFlow6}>{labels.LBL_Add_Task}</div>
                    <div lwc:if={popupFlow7}>{currentTaskName}</div>
                    <div lwc:if={popupFlow8}>{labels.agf__ADM_Work_Create}</div>
                </header>
                <div class="slds-modal__content slds-p-horizontal--x-small" id="modal-content-id">
                    <lightning-flow style="position: relative;" lwc:if={popupFlow1}
                        flow-api-name={Work_Ticket_Qualification_Process_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow2}
                        flow-api-name={Work_Email_Notification_Activation_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow3}
                        flow-api-name={Work_Register_Communication_Process_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow4}
                        flow-api-name={Work_Status_Change_Process_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow5}
                        flow-api-name={Store_Case_Update_Record_Type_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow6}
                        flow-api-name={Work_Create_New_Bug_Task_flowApiName} flow-input-variables={inputs}
                        onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow7}
                        flow-api-name={Commercial_Plan_Task_List_Update_Task_flowApiName}
                        flow-input-variables={taskInputs} onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                    <lightning-flow style="position: relative;" lwc:if={popupFlow8}
                        flow-api-name={Work_Create_Dev_Request_From_Bug_Or_User_Story_flowApiName}
                        flow-input-variables={inputs} onstatuschange={handleFlowStatusChange}>
                    </lightning-flow>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <template if:true={showEditPopup}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-modal_small slds-fade-in-open">
            <div class="slds-modal__container">
                <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse"
                    onclick={cancelDescentProduct}>
                    <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                        <use xlink:href="/_slds/icons/utility-sprite/svg/symbols.svg#close">
                        </use>
                    </svg>
                    <span class="slds-assistive-text">{labels.LBL_Cancel}</span>
                </button>
                <template if:true={showEditStoreCase}>
                    <header class="slds-modal__header">
                        <div>{storeCase.Name}</div>
                    </header>
                    <div class="slds-modal__content slds-p-around_small" style="position: relative;">
                        <div
                            class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                            <span class="slds-form-element__label">
                                <!-- {fieldLabelsMap.agf__ADM_Work__c_RecordTypeId} -->
                                Type d'enregistrement
                            </span>
                            <div class="slds-form-element__control">
                                <div class="slds-form-element__static slds-grid">
                                    <lightning-formatted-text value={storeCase.RecordType.Name}>
                                    </lightning-formatted-text>
                                    <div class="changeRecordTypeButton slds-p-left_x-small"
                                        data-name="SCREEN_Work_Change_Record_Type" onclick={handleRecordCall}>
                                        <lightning-button-icon variant="bare" size="small"
                                            icon-name="utility:change_record_type"
                                            data-name="SCREEN_Work_Change_Record_Type"
                                            onclick={handleRecordCall}></lightning-button-icon>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <lightning-spinner lwc:if={isEditPopupLoading} size="medium"></lightning-spinner>

                        <div class="slds-grid">
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-record-edit-form record-id={storeCase.Id} object-api-name="agf__ADM_Work__c"
                                    record-type-id={storeCase.RecordTypeId}>
                                    <lightning-input-field value={storeCase.Business_Process__c}
                                        field-name="Business_Process__c" data-object="agf__ADM_Work__c"
                                        data-field="Business_Process__c" onchange={handleFieldEdits}>
                                    </lightning-input-field>
                                    <lightning-input-field value={storeCase.Sub_Epic__c} field-name="Sub_Epic__c"
                                        data-object="agf__ADM_Work__c" data-field="Sub_Epic__c"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                </lightning-record-edit-form>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-record-edit-form record-id={storeCase.Id} object-api-name="agf__ADM_Work__c"
                                    record-type-id={storeCase.RecordTypeId}>
                                    <lightning-input-field value={storeCase.agf__Priority__c}
                                        field-name="agf__Priority__c" data-object="agf__ADM_Work__c"
                                        data-field="agf__Priority__c"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                    <lightning-input-field value={storeCase.Channel__c} field-name="Channel__c"
                                        data-object="agf__ADM_Work__c" data-field="Channel__c"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                </lightning-record-edit-form>
                            </div>
                        </div>
                    </div>
                </template>
                <template if:true={showEditContact}>
                    <header class="slds-modal__header">
                        <div>{storeCase.Client_Contact__r.Name}</div>
                    </header>
                    <div class="slds-modal__content slds-p-around_small">
                        <lightning-spinner lwc:if={isEditPopupLoading} size="medium"></lightning-spinner>
                        <div class="slds-grid">
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-record-edit-form record-id={storeCase.Client_Contact__c}
                                    object-api-name="Contact">
                                    <lightning-input-field value={storeCase.Client_Contact__r.FirstName}
                                        field-name="FirstName" data-object="Contact" data-field="FirstName"
                                        onchange={handleFieldEdits}>
                                    </lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.Salutation}
                                        field-name="Salutation" data-object="Contact" data-field="Salutation"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.Phone} field-name="Phone"
                                        data-object="Contact" data-field="Phone"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.Email} field-name="Email"
                                        data-object="Contact" data-field="Email"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.MailingAddress}
                                        field-name="MailingAddress" data-object="Contact" data-field="MailingAddress"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                </lightning-record-edit-form>
                            </div>
                            <div class="slds-col slds-size_1-of-2">
                                <lightning-record-edit-form record-id={storeCase.Client_Contact__c}
                                    object-api-name="Contact">
                                    <lightning-input-field value={storeCase.Client_Contact__r.LastName}
                                        field-name="LastName" data-object="Contact" data-field="LastName"
                                        onchange={handleFieldEdits}>
                                    </lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.BirthDate}
                                        field-name="BirthDate" data-object="Contact" data-field="BirthDate"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                    <lightning-input-field value={storeCase.Client_Contact__r.MobilePhone}
                                        field-name="MobilePhone" data-object="Contact" data-field="MobilePhone"
                                        onchange={handleFieldEdits}></lightning-input-field>
                                </lightning-record-edit-form>
                            </div>
                        </div>
                    </div>
                </template>
                <template if:true={showRelatedCases}>
                    <header class="slds-modal__header">
                        <div>{labels.LBL_Related_Tickets}</div>
                    </header>
                    <div class="slds-modal__content">
                        <template lwc:if={hasRelatedStoreCases}>
                            <div class="slds-scrollable">
                                <table class="slds-table slds-no-row-hover slds-table_bordered">
                                    <thead>
                                        <tr>
                                            <th>{fieldLabelsMap.agf__ADM_Work__c_Name}</th>
                                            <th>{fieldLabelsMap.agf__ADM_Work__c_agf__Details__c}</th>
                                            <th>{fieldLabelsMap.agf__ADM_Work__c_CreatedDate}</th>
                                            <th>{fieldLabelsMap.agf__ADM_Work__c_Acknowledgement_SLA__c}</th>
                                            <th>{fieldLabelsMap.agf__ADM_Work__c_agf__Status__c}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template for:each={relatedStoreCases} for:item="ticket">
                                            <tr key={ticket.Id}>
                                                <td>
                                                    <a href={ticket.ticketLink} target="_blank">{ticket.Name}</a>
                                                </td>
                                                <td class="breakCell"><lightning-formatted-text
                                                        value={ticket.agf__Details__c}></lightning-formatted-text>
                                                </td>
                                                <td>
                                                    <lightning-formatted-date-time value={ticket.CreatedDate}
                                                        year="numeric" month="numeric" day="numeric" hour="2-digit"
                                                        minute="2-digit" hour12="false"></lightning-formatted-date-time>
                                                </td>
                                                <td><lightning-formatted-date-time year="numeric" month="numeric"
                                                        day="numeric"
                                                        value={ticket.Acknowledgement_SLA__c}></lightning-formatted-date-time>
                                                </td>
                                                <td><lightning-formatted-text
                                                        value={ticket.agf__Status__c}></lightning-formatted-text></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </template>
                        <template lwc:else>
                            <div class="slds-text-align_center">
                                <h2>{labels.LBL_No_Item_To_Display}</h2>
                            </div>
                        </template>
                    </div>
                </template>
                <div class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" aria-label={labels.LBL_Cancel}
                        onclick={cancelDescentProduct}>{labels.LBL_Cancel}</button>
                    <template if:true={showEditStoreCase}>
                        <button class="slds-button slds-button_brand" data-object="agf__ADM_Work__c"
                            onclick={saveHandler}>{labels.LBL_Save}</button>
                    </template>
                    <template if:true={showEditContact}>
                        <button class="slds-button slds-button_brand" data-object="Contact"
                            onclick={saveHandler}>{labels.LBL_Save}</button>
                    </template>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
    <template if:true={popupDeleteMessage}>
        <div class="slds-backdrop slds-backdrop_open">
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
                class="slds-modal slds-fade-in-open slds-modal_small">
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-02" class="slds-modal__title slds-hyphenate">
                            Do you want to delete this task ?
                        </h1>
                    </div>
                    <div class="slds-modal__footer">
                        <lightning-button label="No" variant="neutral" onclick={toggleConfirmPopup}
                            class="slds-m-right_x-small"></lightning-button>
                        <lightning-button label="Yes" variant="brand" onclick={toggleDeleteTask}>
                        </lightning-button>
                    </div>
                </div>
            </section>
        </div>
    </template>
</template>